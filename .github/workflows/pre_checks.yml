name: Pre-Production Checks
run-name: ${{ github.actor }}'s Django CI && Testing
on:
    push:
        branches: [pre-production]

jobs:
    django_ci:
        name: Django CI
        runs-on: ubuntu-latest
        
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Setup Python ${{ matrix.python-version }}
              uses: actions/setup-python@v4
              with:
                python-version: '3.10'

            - name: Install requirements
              run: |
                  pip install --upgrade pip
                  pip install -r requirements.txt

            - name: Create Pull Request to Production branch
              run: gh pr create -B pre-production -H production --title 'Merge Pre-Production changes into Production' --body 'Created by GitHub Actions'
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Setup tests
              env:
                DJANGO_SETTINGS_MODULE: polls.settings
              run: pytest